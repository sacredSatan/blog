<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><style type=text/css>body{font-family:monospace}</style><title>Sneaky bugs: startsWith and indexOf with empty string</title><link rel=stylesheet href=/blog/css/style.css></head><body><header><div class=header-title-wrapper><div class=header-title><a class=header-link href=https://sacredsatan.com/blog>sacredSatan/blog</a><div class=header-subtitle>slash blog... slAsH bLOg... SLASH BLOG.</div></div><nav><a href=/blog/posts/><b>Posts</b></a>.
<a href=/blog/tags/><b>Tags</b></a>.
<a href=/blog/categories/><b>Categories</b></a>.</nav></div></header><main><article><h1>Sneaky bugs: startsWith and indexOf with empty string</h1><b><time>15.08.2022 10:22</time></b>
<a href=/blog/tags/javascript>javascript</a>
<a href=/blog/tags/bugs>bugs</a>
<a href=/blog/tags/string>string</a><div><p><code>String.startsWith()</code> returns a boolean after testing whether the string begins with the search string passed to it, and has a second argument to specify the starting location for the search.</p><p>All straightforward until you try to pass an empty search string, in which case it always returns <code>true</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>str</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Artyom&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>str</span>.<span style=color:#a6e22e>startsWith</span>(<span style=color:#e6db74>&#34;Art&#34;</span>); <span style=color:#75715e>// expected: true, actual: true
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>str</span>.<span style=color:#a6e22e>startsWith</span>(<span style=color:#e6db74>&#34;yom&#34;</span>); <span style=color:#75715e>// expected: false, actual: false
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>str</span>.<span style=color:#a6e22e>startsWith</span>(<span style=color:#e6db74>&#34;&#34;</span>); <span style=color:#75715e>// expected: false?, actual: true
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>str</span>.<span style=color:#a6e22e>startsWith</span>(<span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#66d9ef>Infinity</span>); <span style=color:#75715e>// expected: false?, actual: true
</span></span></span></code></pre></div><p>I didn&rsquo;t expect that to happen, and checking on MDN didn&rsquo;t directly help since the page for <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/startsWith>startsWith</a> doesn&rsquo;t mention this behaviour.</p><p>However, the MDN page links to the <a href=https://tc39.es/ecma262/multipage/text-processing.html#sec-string.prototype.startswith>specification</a> which describes the steps performed while this method is called. It has a step that returns <code>true</code> if the search string&rsquo;s length is <code>0</code>.</p><pre tabindex=0><code>  [...]
  9. Let searchLength be the length of searchStr.
  10. If searchLength = 0, return true.
  [...]
</code></pre><p><code>String.indexOf()</code> has a lot of gotchas when it comes to empty strings but I expected this newer method to be better in this regard. At least the behaviour of <code>indexOf</code> is well defined in the <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/indexOf#return_value>MDN page</a>.</p><p>Since I expected the call with empty search string to return <code>false</code>, I introduced a bug in the code which sneaked past me even after reading through the code as I wasn&rsquo;t aware of this behaviour.</p></div></article></main><aside><div><div><h3>LATEST POSTS</h3></div><div><ul><li><a href=/blog/posts/2023-01-01-odd-api-design-debounced-loadoptions-react-select/>Odd Api Design: loadOptions prop in async React Select</a></li><li><a href=/blog/posts/2022-08-15-sneaky-bugs-string-startswith-indexof/>Sneaky bugs: startsWith and indexOf with empty string</a></li><li><a href=/blog/posts/2021-11-28-sneaky-bugs-lodash-trimstart-substring/>Sneaky bugs: using lodash/trimStart to trim off a leading substring</a></li><li><a href=/blog/posts/2021-11-22-testing/>Testing</a></li></ul></div></div></aside><footer><p>&copy; 2023.
<a href=https://sacredsatan.com/><b>/</b></a>.
<a href=https://sacredsatan.com/blog><b>/blog</b></a>.
<a href=https://github.com/sacredsatan><b>Github</b></a>.</p></footer></body></html>